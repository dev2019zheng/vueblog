<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Canvas动画案例 | 鱼知鱼博客笔记</title>
    <meta name="description" content="做大屏开发突然想到的一个轮盘转动实现,用的canvas-2d, 当然,这类效果使用webgl实现因该会更好,不过笔者webgl目前只学的点皮毛,实际应用还欠缺点经验.
&gt;
&gt; 基础的canvas API可以看这份网道教程
&gt;
&gt;完整代码在文末

**本文为原创博文,禁止转载,如需转载请联系作者:[鱼知鱼](m ...">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/vueblog/assets/css/0.styles.c8222f3d.css" as="style"><link rel="preload" href="/vueblog/assets/js/app.0d60cf52.js" as="script"><link rel="preload" href="/vueblog/assets/js/6.91ba3c65.js" as="script"><link rel="preload" href="/vueblog/assets/js/4.0d6f3d58.js" as="script"><link rel="preload" href="/vueblog/assets/js/7.2fd40fe9.js" as="script"><link rel="prefetch" href="/vueblog/assets/js/1.0bea4ea4.js"><link rel="prefetch" href="/vueblog/assets/js/10.9007f252.js"><link rel="prefetch" href="/vueblog/assets/js/11.e918eae2.js"><link rel="prefetch" href="/vueblog/assets/js/12.691e6f01.js"><link rel="prefetch" href="/vueblog/assets/js/13.8ed74d44.js"><link rel="prefetch" href="/vueblog/assets/js/14.8912956c.js"><link rel="prefetch" href="/vueblog/assets/js/15.7512aea5.js"><link rel="prefetch" href="/vueblog/assets/js/16.edec554a.js"><link rel="prefetch" href="/vueblog/assets/js/17.df2668f4.js"><link rel="prefetch" href="/vueblog/assets/js/18.a2ff8aab.js"><link rel="prefetch" href="/vueblog/assets/js/19.c3176623.js"><link rel="prefetch" href="/vueblog/assets/js/5.02772f88.js"><link rel="prefetch" href="/vueblog/assets/js/8.36703181.js"><link rel="prefetch" href="/vueblog/assets/js/9.73bbd394.js"><link rel="prefetch" href="/vueblog/assets/js/vuejs-paginate.8c609cf2.js">
    <link rel="stylesheet" href="/vueblog/assets/css/0.styles.c8222f3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/vueblog/" class="nav-link home-link">鱼知鱼博客笔记 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/vueblog/" class="nav-link">博客</a></li><li class="nav-item"><a href="/vueblog/tag/" class="nav-link">标签</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/vueblog/" class="nav-link mobile-home-link">鱼知鱼博客笔记 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/vueblog/" class="nav-link">博客</a></li><li class="mobile-nav-item"><a href="/vueblog/tag/" class="nav-link">标签</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">dev2019zheng</span> <span itemprop="address">   in HangZhou</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-04-03T00:00:00.000Z">
      Fri Apr 03 2020
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-d832e844><a href="/vueblog/tag/canvas" data-v-d832e844> canvas </a></li><li class="post-tag" data-v-d832e844><a href="/vueblog/tag/animate" data-v-d832e844> animate </a></li><li class="post-tag" data-v-d832e844><a href="/vueblog/tag/bigscreen" data-v-d832e844> bigscreen </a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h1 id="canvas动画案例"><a href="#canvas动画案例" class="header-anchor">#</a> Canvas动画案例</h1> <blockquote><p>做大屏开发突然想到的一个轮盘转动实现,用的canvas-2d, 当然,这类效果使用webgl实现因该会更好,不过笔者webgl目前只学的点皮毛,实际应用还欠缺点经验.</p> <p>基础的canvas API可以看这份<a href="http://wangdoc.com/webapi/canvas.html" target="_blank" rel="noopener noreferrer">网道教程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>完整代码在文末</p></blockquote> <p><strong>本文为原创博文,禁止转载,如需转载请联系作者:<a href="mailto:18205157336@163.com">鱼知鱼</a></strong></p> <h2 id="预览效果如下"><a href="#预览效果如下" class="header-anchor">#</a> 预览效果如下</h2> <p><img src="/vueblog/assets/img/aa2.2a777278.gif" alt="预览效果"></p> <h2 id="前期准备"><a href="#前期准备" class="header-anchor">#</a> 前期准备</h2> <h3 id="资源"><a href="#资源" class="header-anchor">#</a> 资源</h3> <p>一张规则正圆的png或者svg图即可,下面即这次使用到的图片资源</p> <p><img src="/vueblog/assets/img/img3.02310ede.png" alt="转盘"></p> <h3 id="开发工具"><a href="#开发工具" class="header-anchor">#</a> 开发工具</h3> <p>笔者使用Atom开发,因为可以实时预览书写的html界面,类似如下:</p> <p><img src="/vueblog/assets/img/rotate.c6dca7d7.gif" alt="atom开发"></p> <h2 id="开发思路"><a href="#开发思路" class="header-anchor">#</a> 开发思路</h2> <p>本来打算使用gif做背景,这样就做不了交互效果,设计师给的又是这么一张正圆的图,如何做到类3d的斜二侧效果呢?后来思路一转,想想可以先用离屏渲染绘制一个正圆的canvas图像,再将离屏渲染的canvas绘制到按缩放比<code>1:0.3</code>绘制到页面canvas上,期间只需要绘制离屏渲染的canvas图像时改变图片旋转就可以达到扁平旋转</p> <h3 id="基本准备"><a href="#基本准备" class="header-anchor">#</a> 基本准备</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> item1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">//最外层</span>
  item2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 中间层</span>
  item3 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 最内层</span>
<span class="token keyword">var</span> _W <span class="token operator">=</span> _H <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> speed <span class="token operator">=</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token comment">// 旋转速度, 正值顺时针</span>
  radius <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span> <span class="token comment">// 图形半径</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myCanvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实际看到的canvas</span>
canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> _W<span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> _H<span class="token punctuation">;</span>
<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'./circle.svg'</span><span class="token punctuation">;</span>
<span class="token comment">// img.src = './img3.png';</span>

</code></pre></div><h3 id="circleitem类"><a href="#circleitem类" class="header-anchor">#</a> CircleItem类</h3> <p>为此,需要创建一个<code>CircleItem</code>类,用来完成单个圆环的旋转功能,类的实例属性有:</p> <ul><li><code>_r</code>: 绘制半径,即最终椭圆的长轴</li> <li><code>_img</code>: 绘制的图像</li> <li><code>_w</code>: 离屏渲染的canvas宽度(2倍半径)</li> <li><code>_h</code>: 离屏渲染的canvas高度(2倍半径)</li> <li><code>_x</code>: 绘制在实际canvas上的中心x坐标</li> <li><code>_y</code>: 绘制在实际canvas上的中心y坐标</li> <li><code>speed</code>: 椭圆的旋转速度,每次刷新绘制时旋转的角度数(单位: °) speed=1 =&gt; 下一次绘制旋转Math.PI/180</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">CircleItem</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">img<span class="token punctuation">,</span> r<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> speed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">=</span> r<span class="token punctuation">;</span> <span class="token comment">// 半径</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_img <span class="token operator">=</span> img<span class="token punctuation">;</span> <span class="token comment">// 图片</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_w <span class="token operator">=</span> r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 缓存canvas宽度</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_h <span class="token operator">=</span> r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 缓存canvas高度</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_x <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token comment">// 外部绘制中心</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_y <span class="token operator">=</span> y<span class="token punctuation">;</span> <span class="token comment">// 外部绘制中心</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_speed <span class="token operator">=</span> speed<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>rectCenterPoint <span class="token operator">=</span> <span class="token punctuation">{</span>
    x<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r<span class="token punctuation">,</span>
    y<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r
  <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 内部圆心</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="离屏渲染初始化"><a href="#离屏渲染初始化" class="header-anchor">#</a> 离屏渲染初始化</h3> <p><code>CircleItem</code>初始化时将创建离屏渲染的缓存canvas,创建方法是定义在原型上的<code>cache</code>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">CircleItem</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">cache</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCanvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCanvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_w<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCanvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_h<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="draw方法"><a href="#draw方法" class="header-anchor">#</a> draw方法</h3> <p><code>CircleItem</code>类还需要有个绘制到实际canvas的方法<code>draw</code>,该方法每次刷新绘制时,先将实际canvas伸缩变换为比例<code>1:0.3</code>,将离屏渲染的图像绘制到canvas上,再将比例变换回来,这样显示在画布上的就是一个椭圆图像；绘制方法同样也是定义在原型上:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">CircleItem</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheCanvas<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_w<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_h<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_y <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="rotate方法"><a href="#rotate方法" class="header-anchor">#</a> rotate方法</h3> <p>当然,要达到动态的效果还需要在每次绘制前将图像旋转一定角度, 即定义在原型上的<code>rotate</code>方法, 要注意的是,默认旋转中心是<code>(0,0)</code>, 需要先将缓存的canvas进行平移变换到中心,再进行旋转:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">CircleItem</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">rotate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_w<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_h<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rectCenterPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rectCenterPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_speed <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>rectCenterPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>rectCenterPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="创建实例"><a href="#创建实例" class="header-anchor">#</a> 创建实例</h3> <p>这样,<code>CircleItem</code>类的基本方法就定义好了,在图像加载完的回调方法中创建实例:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 图片加载完成是创建实例</span>
  item1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CircleItem</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> speed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 图像, 图圆形长半径, 显示中心x,显示中心y, 旋转速度</span>
  item2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CircleItem</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> radius <span class="token operator">-</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token operator">-</span>speed<span class="token operator">*</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  item3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CircleItem</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> radius <span class="token operator">-</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> speed<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*
// 也可以绘制不同的图像,以达到不同层次使用不同的轮盘或不同的转速
img.onload = function() {
  item1 = new CircleItem(img, radius, 400, 400, speed);
};
img2.onload = function() {
  item2 = new CircleItem(img, radius, 400, 400, speed*1.2); 
};
*/</span>
</code></pre></div><h3 id="重绘动画"><a href="#重绘动画" class="header-anchor">#</a> 重绘动画</h3> <p>最后,还需要定义一个<code>animate</code>方法来不断刷新新图像绘制,在重绘的实现上你可能会想到使用js 的 setTimeout() 方法，但是:</p> <blockquote><p>setTimeout 和 setInterval 的问题是: 它们都不精确。它们的内在运行机制决定了时间间隔参数实际上只是指定了把动画代码添加到浏览器 UI 线程队列中以等待执行的时间。如果队列前面已经加入了其他任务，那动画代码就要等前面的任务完成后再执行。</p></blockquote> <p>所以我们需要使用另一个函数 —— <code>requestAnimationFrame()</code>:</p> <blockquote><p>window.requestAnimationFrame() 方法告诉浏览器，你希望执行动画，并请求浏览器调用指定的函数在下一次重绘之前更新动画。该方法使用一个回调函数作为参数，这个回调函数会在浏览器重绘之前调用。</p></blockquote> <p>一般写动画都是使用<code>requestAnimationFrame</code>函数来请求重绘的。</p> <p><code>animate</code>方法实现如下:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> _W<span class="token punctuation">,</span> _H<span class="token punctuation">)</span><span class="token punctuation">;</span>
  item1 <span class="token operator">&amp;&amp;</span> item1<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实例创建完成才绘制</span>
  item2 <span class="token operator">&amp;&amp;</span> item2<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  item3 <span class="token operator">&amp;&amp;</span> item3<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>到此, 轮盘动画实现完毕!</p> <h2 id="完整代码"><a href="#完整代码" class="header-anchor">#</a> 完整代码</h2> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ie=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">#myCanvas</span> <span class="token punctuation">{</span>
      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid skyblue<span class="token punctuation">;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>12<span class="token punctuation">,</span> 30<span class="token punctuation">,</span> 78<span class="token punctuation">,</span> 0.8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myCanvas<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>800<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>800<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    您的浏览器不支持 Canvas
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">var</span> item1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      item2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      item3 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> _W <span class="token operator">=</span> _H <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> speed <span class="token operator">=</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token comment">// 旋转速度, 正值顺时针</span>
      radius <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span> <span class="token comment">// 图形半径</span>
    <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'myCanvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> _W<span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> _H<span class="token punctuation">;</span>
    <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'./circle.svg'</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      item1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CircleItem</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> radius<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> speed<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 图像, 图圆形长半径, 显示中心x,显示中心y, 旋转速度</span>
      item2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CircleItem</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> radius <span class="token operator">-</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token operator">-</span>speed<span class="token operator">*</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      item3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CircleItem</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> radius <span class="token operator">-</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> speed<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">CircleItem</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">img<span class="token punctuation">,</span> r<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> speed</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">=</span> r<span class="token punctuation">;</span> <span class="token comment">// 半径</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_img <span class="token operator">=</span> img<span class="token punctuation">;</span> <span class="token comment">// 图片</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_w <span class="token operator">=</span> r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 缓存canvas宽度</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_h <span class="token operator">=</span> r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 缓存canvas高度</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_x <span class="token operator">=</span> x<span class="token punctuation">;</span> <span class="token comment">// 外部绘制中心</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_y <span class="token operator">=</span> y<span class="token punctuation">;</span> <span class="token comment">// 外部绘制中心</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_speed <span class="token operator">=</span> speed<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>rectCenterPoint <span class="token operator">=</span> <span class="token punctuation">{</span>
        x<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r<span class="token punctuation">,</span>
        y<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r
      <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 内部圆心</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">CircleItem</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ctx<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cacheCanvas<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_w<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_h<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_y <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ctx<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">CircleItem</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">cache</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCanvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCanvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_w<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCanvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_h<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">CircleItem</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">rotate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_w<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_h<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rectCenterPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rectCenterPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_speed <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>rectCenterPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>rectCenterPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>cacheCtx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_r <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> _W<span class="token punctuation">,</span> _H<span class="token punctuation">)</span><span class="token punctuation">;</span>
      item1 <span class="token operator">&amp;&amp;</span> item1<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      item2 <span class="token operator">&amp;&amp;</span> item2<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      item3 <span class="token operator">&amp;&amp;</span> item3<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>

</code></pre></div></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#预览效果如下" title="预览效果如下">预览效果如下</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#前期准备" title="前期准备">前期准备</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#资源" title="资源">资源</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#开发工具" title="开发工具">开发工具</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#开发思路" title="开发思路">开发思路</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#基本准备" title="基本准备">基本准备</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#circleitem类" title="CircleItem类">CircleItem类</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#离屏渲染初始化" title="离屏渲染初始化">离屏渲染初始化</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#draw方法" title="draw方法">draw方法</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#rotate方法" title="rotate方法">rotate方法</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#创建实例" title="创建实例">创建实例</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#重绘动画" title="重绘动画">重绘动画</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#完整代码" title="完整代码">完整代码</a></div></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940><li class="contact-item" data-v-fdbf4940><a href="https://github.com/dev2019zheng/vueblog" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-fdbf4940><svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-fdbf4940><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-fdbf4940></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940><li class="copyright-item" data-v-fdbf4940><a href="/vueblog/2020/04/03/canvas%E5%8A%A8%E7%94%BB%E6%A1%88%E4%BE%8B/.html" class="nav-link" data-v-fdbf4940>MIT Licensed | Copyright © 2018-present Vue.js</a></li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/vueblog/assets/js/app.0d60cf52.js" defer></script><script src="/vueblog/assets/js/6.91ba3c65.js" defer></script><script src="/vueblog/assets/js/4.0d6f3d58.js" defer></script><script src="/vueblog/assets/js/7.2fd40fe9.js" defer></script>
  </body>
</html>
